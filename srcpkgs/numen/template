# Template file for 'numen'
pkgname=numen
version=0.7
revision=1
build_style=go
go_import_path="git.sr.ht/~geb/numen"
go_ldflags="-X 'main.Version=${version}'
 -X 'main.DefaultModelPackage=vosk-model-small-en-us'
 -X 'main.DefaultModelPaths=/usr/local/share/vosk-models/small-en-us /usr/share/vosk-models/small-en-us'
 -X 'main.DefaultPhrasesDir=/etc/numen/phrases'"
hostmakedepends="scdoc"
makedepends="vosk-api libgomp-devel"
checkdepends="vosk-model-small-en-us"
depends="alsa-utils dmenu dotool xdotool xset"
short_desc="Voice control for handsfree computing"
maintainer="John Gebbie <me@johngebbie.com>"
license="AGPL-3.0-only"
homepage="https://numenvoice.com"
changelog="https://git.sr.ht/~geb/numen/blob/master/CHANGELOG.md"
distfiles="https://git.sr.ht/~geb/numen/archive/${version}.tar.gz"
checksum=314de269501ca6c4104977774e32cd00e295569888771f7ec91d65e423a38e75
conf_files="/etc/sv/numen/conf"

if [ "$XBPS_TARGET_LIBC" = musl ]; then
	makedepends+=" libexecinfo-devel"
fi

system_accounts="_numen"

CGO_ENABLED=1

pre_build() {
	# for the vosk-api package (openblas)
	export CGO_LDFLAGS="$CGO_LDFLAGS -fopenmp"

	if [ "$XBPS_TARGET_LIBC" = musl ]; then
		# for the vosk-api package (openfst)
		export CGO_LDFLAGS="$CGO_LDFLAGS -lexecinfo"
	fi
}

post_install() {
	vbin numenc
	vmkdir etc/numen
	cp -a scripts phrases ${DESTDIR}/etc/numen
	scdoc <doc/numen.1.scd >numen.1
	vman numen.1
	vsv numen
}
