# Template file for 'pcsx2'
pkgname=pcsx2
version=2.3.21
revision=1
_patches=1123a8e1ff0cb7d1b2a9a6772df675388982d4ab
build_wrksrc="pcsx2-${version}"
archs="x86_64*"
build_style=cmake
configure_args="
 -DCMAKE_C_COMPILER=clang
 -DCMAKE_CXX_COMPILER=clang++
 -DCMAKE_BUILD_TYPE=Release
 -DCMAKE_DISABLE_PRECOMPILE_HEADERS=ON
 -DDISABLE_ADVANCE_SIMD=ON
 -DENABLE_TESTS=ON
 -DPACKAGE_MODE=ON
 -DUSE_BACKTRACE=OFF
 -DUSE_LINKED_FFMPEG=ON
 -DUSE_VTUNE=OFF
 -DUSE_VULKAN=ON
 -DWAYLAND_API=ON
 -DX11_API=ON
 -DPCSX2_GIT_TAG=v${version}"
make_check_target="unittests"
hostmakedepends="pkg-config clang"
makedepends="SDL2-devel alsa-lib-devel extra-cmake-modules ffmpeg-devel
 libcurl-devel libpcap-devel libpng-devel libwebp-devel libzip-devel lz4-devel
 qt6-base-devel qt6-tools-devel shaderc vulkan-loader wayland-devel zlib-devel"
depends="desktop-file-utils gst-plugins-base1"
checkdepends="perl"
short_desc="Sony PlayStation 2 emulator"
maintainer="hazen2215 <haz@disroot.org>"
license="GPL-3.0-or-later"
homepage="http://www.pcsx2.net"
distfiles="https://github.com/PCSX2/pcsx2/archive/refs/tags/v${version}.tar.gz
 https://github.com/PCSX2/pcsx2_patches/archive/${_patches}.tar.gz"
checksum="3914c06b1a0a04ddb1067807abadebf6348545cf2bd59981cc64dec6283ebfd9
 bbdd8224f97590c8362ff126f6b1def930debbb08002cdb9590b5e3bdb9d5104"

patch_args="-Np1 --directory=${build_wrksrc}"

CXXFLAGS="-Wno-macro-redefined -Wno-deprecated-declarations"

post_extract() {
	mv pcsx2_patches-${_patches} ${build_wrksrc}/patches
}

post_build() {
	bsdtar --strip-components=2 -cvaf patches.zip patches/patches/*.pnach
}

post_install() {
	ln -s pcsx2-qt ${DESTDIR}/usr/bin/pcsx2
	vinstall ${FILESDIR}/PCSX2.desktop 644 usr/share/applications
	vinstall patches.zip 644 usr/share/PCSX2/resources
	vinstall bin/resources/icons/AppIconLarge.png 644 \
		usr/share/icons/hicolor/512x512/apps PCSX2.png
	vinstall pcsx2-qt/resources/icons/AppIcon64.png 644 \
		usr/share/icons/hicolor/64x64/apps PCSX2.png
}
