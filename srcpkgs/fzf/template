# Template file for 'fzf'
pkgname=fzf
version=0.65.1
revision=1
build_style=go
go_import_path="github.com/junegunn/fzf"
go_ldflags="-X main.version=${version} -X main.revision="
makedepends="ncurses-devel"
short_desc="Command-line fuzzy finder"
maintainer="Leah Neukirchen <leah@vuxu.org>"
license="MIT"
homepage="https://github.com/junegunn/fzf"
changelog="https://raw.githubusercontent.com/junegunn/fzf/master/CHANGELOG.md"
distfiles="https://github.com/junegunn/fzf/archive/refs/tags/v${version}.tar.gz"
checksum=82fa35dc3ba5d716db26a507f90bb0e724f586123c28ad3fb376bd8384669abf

post_install() {
	cd ${wrksrc}
	vbin bin/fzf-tmux
	vman man/man1/fzf.1
	vman man/man1/fzf-tmux.1
	vlicense LICENSE

	sed -i -e 's#source ~/\.fzf\.bash; ##' shell/key-bindings.bash
	vinstall plugin/fzf.vim 644 usr/share/vim/vimfiles/plugin
	vinstall plugin/fzf.vim 644 usr/share/nvim/runtime/plugin

	vinstall shell/completion.bash 644 usr/share/fzf
	vinstall shell/completion.zsh 644 usr/share/fzf
	vinstall shell/key-bindings.zsh 644 usr/share/fzf
	vinstall shell/key-bindings.bash 644 usr/share/fzf
	vinstall shell/key-bindings.fish 644 usr/share/fzf
}

export CGO_ENABLED=0
post_patch() {
	cat <<-! >>go.mod
		require (
			github.com/koron/gomigemo v0.0.0-20210612172932-2cc85a8ebac1
			github.com/koron/gelatin v0.0.0-20160729020448-88d6a03ce765 // indirect
			github.com/koron/go-skkdict v0.0.0-20160727125427-1bfa372d61d2 // indirect
		)
	!

	cat <<-! >>go.sum
		github.com/koron/gelatin v0.0.0-20160729020448-88d6a03ce765 h1:/k2Hth0PQq47SNc2pvOnwEQbjtu7HgtQu8TFXKhABKE=
		github.com/koron/gelatin v0.0.0-20160729020448-88d6a03ce765/go.mod h1:TJD1ti844npsMLPGgPPLa1Ozaz0W36N9EL6dQmTZ0kU=
		github.com/koron/go-skkdict v0.0.0-20160727125427-1bfa372d61d2 h1:ibW6FKhStt/gAMEndugP/3kNb/Dm+eWEx9rjCMN37A8=
		github.com/koron/go-skkdict v0.0.0-20160727125427-1bfa372d61d2/go.mod h1:RHH1ylFPxnWBxAbpUZraJ4iCu4GO0jvbvx0VIDawT8w=
		github.com/koron/gomigemo v0.0.0-20210612172932-2cc85a8ebac1 h1:c8En066E9zzXkMTsc5NsaDLLbJtHFJ+0DptfAV9u6C4=
		github.com/koron/gomigemo v0.0.0-20210612172932-2cc85a8ebac1/go.mod h1:gc/0myyTk3JFTaDG9+2TV6tE24BxxUXnQO1cn4WSjM8=
	!
}
