# Template file for 'fricas'
pkgname=fricas
version=1.3.9
revision=1
build_style=gnu-configure
hostmakedepends="sbcl tar"
makedepends="libXpm-devel gmp-devel libICE-devel libSM-devel libX11-devel
 libXpm-devel"
depends="sbcl"
short_desc="Advanced computer algebra system"
maintainer="hazen2215 <haz@disroot.org>"
license="BSD-3-Clause"
homepage="https://fricas.github.io/"
changelog="https://raw.githubusercontent.com/fricas/fricas/master/ChangeLog"
distfiles="https://github.com/fricas/fricas/releases/download/${version}/fricas-${version}-full.tar.bz2"
checksum=e513dc7df33418dd25eabf08807265c1dc70c29db2e2421d2793372671990b37

CFLAGS="-DSIGCLD=SIGCHLD"
disable_parallel_build=yes
# XX: fix
nopie_files="
 /usr/lib/fricas/target/aarch64-unknown-linux-gnu/bin/FRICASsys
 /usr/lib/fricas/target/aarch64-unknown-linux-musl/bin/FRICASsys
 /usr/lib/fricas/target/armv6l-linux-musleabihf/bin/FRICASsys
 /usr/lib/fricas/target/armv6l-unknown-linux-gnueabihf/bin/FRICASsys
 /usr/lib/fricas/target/armv7l-linux-musleabihf/bin/FRICASsys
 /usr/lib/fricas/target/armv7l-unknown-linux-gnueabihf/bin/FRICASsys
 /usr/lib/fricas/target/i686-linux-musl/bin/FRICASsys
 /usr/lib/fricas/target/i686-pc-linux-gnu/bin/FRICASsys
 /usr/lib/fricas/target/powerpc-linux-gnu/bin/FRICASsys
 /usr/lib/fricas/target/powerpc-linux-musl/bin/FRICASsys
 /usr/lib/fricas/target/powerpc64-unknown-linux-gnu/bin/FRICASsys
 /usr/lib/fricas/target/powerpc64-unknown-linux-musl/bin/FRICASsys
 /usr/lib/fricas/target/powerpc64le-unknown-linux-gnu/bin/FRICASsys
 /usr/lib/fricas/target/powerpc64le-unknown-linux-musl/bin/FRICASsys
 /usr/lib/fricas/target/powerpcle-linux-gnu/bin/FRICASsys
 /usr/lib/fricas/target/powerpcle-linux-musl/bin/FRICASsys
 /usr/lib/fricas/target/riscv64-unknown-linux-gnu/bin/FRICASsys
 /usr/lib/fricas/target/riscv64-unknown-linux-musl/bin/FRICASsys
 /usr/lib/fricas/target/x86_64-unknown-linux-gnu/bin/FRICASsys
 /usr/lib/fricas/target/x86_64-unknown-linux-musl/bin/FRICASsys
"

do_configure() {
	./configure ${configure_args} \
		--disable-aldor \
		--enable-gmp \
		--with-lisp='sbcl --control-stack-size 512 --dynamic-space-size 6000'
}

post_install() {
	vsed -i ${DESTDIR}/usr/bin/{fricas,efricas} \
		${DESTDIR}/usr/lib/fricas/target/*/bin/fricas -e '1a\
export SBCL_HOME=/usr/lib/sbcl'
	vlicense src/etc/copyright
}
