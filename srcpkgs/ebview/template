# Template file for 'ebview'
pkgname=ebview
version=0.3.6
revision=1
_githash=77519e5c5c77616b75655dcf023bfca6caf8298a
build_style=gnu-configure
hostmakedepends="automake libtool gettext-devel pkg-config glib-devel"
makedepends=" $(vopt_if utf8 'ebu libebu-devel' 'eb libeb-devel')
 gtk+-devel pango-devel"
short_desc="GTK2 based EPWING dictionary viewer"
maintainer="hazen2215 <haz@disroot.org>"
license="GPL-2.0-or-later"
homepage="http://ebview.sourceforge.net/"
changelog="https://raw.githubusercontent.com/sina-ht/ebview/master/ChangeLog"
distfiles="https://github.com/sina-ht/ebview/archive/${_githash}.tar.gz"
checksum=955b9681914066649cd353080c28249383eadb28e44f86ce737e70d9c140efbd
build_options="utf8"
build_options_default="utf8"
desc_option_utf8="Enable support for UTF-8"

CFLAGS="-D_FILE_OFFSET_BITS=64"

export LIBS=-lX11

post_patch() {
	if [ "$build_option_utf8" ]; then
		vsed -i configure.in \
			-e 's,eb/eb\.h,ebu/eb.h,' \
			-e 's/eb_LIB_EB4/eb_LIB_EBU/'
		vsed -i src/defs.h util/ebdump.c \
			-e 's,#include <eb/,#include <ebu/,'
	fi
}

pre_configure() {
	./autogen.sh
}

pre_install() {
	ln -s /usr/share/automake-1.16/mkinstalldirs .
}

post_install() {
	# move locales to /usr/share/locale (needed for musl libc)
	if [ -d ${DESTDIR}/usr/lib/locale ]; then
		mv ${DESTDIR}/usr/lib/locale ${DESTDIR}/usr/share
	fi
}
